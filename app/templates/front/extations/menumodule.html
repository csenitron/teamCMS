<!-- Модуль меню - {{ menu_title }} -->
<nav class="menu-module menu-style-{{ menu_style }}" id="menu-{{ module_instance.id }}">
    
    {% if menu_style == 'horizontal' %}
        <!-- Горизонтальное меню -->
        <div class="horizontal-menu">
            <ul class="menu-list">
                {% for item in menu_tree %}
                    <li class="menu-item {{ item.custom_class }}{% if item.is_featured %} featured{% endif %}">
                        <a href="{{ item.url }}" 
                           class="menu-link"
                           {% if item.open_in_new_tab %}target="_blank" rel="noopener"{% endif %}>
                           
                            {% if show_icons and item.icon %}
                                <img src="{{ item.icon.url }}" alt="{{ item.title }}" class="menu-icon">
                            {% endif %}
                            
                            <span class="menu-text">{{ item.title }}</span>
                            
                            {% if item.children %}
                                <i class="fas fa-chevron-down dropdown-arrow"></i>
                            {% endif %}
                        </a>
                        
                        {% if item.children %}
                            <ul class="submenu">
                                {% for child in item.children %}
                                    <li class="submenu-item {{ child.custom_class }}">
                                        <a href="{{ child.url }}" 
                                           class="submenu-link"
                                           {% if child.open_in_new_tab %}target="_blank" rel="noopener"{% endif %}>
                                           
                                            {% if show_icons and child.icon %}
                                                <img src="{{ child.icon.url }}" alt="{{ child.title }}" class="submenu-icon">
                                            {% endif %}
                                            
                                            <span class="submenu-text">{{ child.title }}</span>
                                        </a>
                                        
                                        {% if child.children %}
                                            <ul class="sub-submenu">
                                                {% for grandchild in child.children %}
                                                    <li class="sub-submenu-item">
                                                        <a href="{{ grandchild.url }}" 
                                                           class="sub-submenu-link"
                                                           {% if grandchild.open_in_new_tab %}target="_blank" rel="noopener"{% endif %}>
                                                            {{ grandchild.title }}
                                                        </a>
                                                    </li>
                                                {% endfor %}
                                            </ul>
                                        {% endif %}
                                    </li>
                                {% endfor %}
                            </ul>
                        {% endif %}
                    </li>
                {% endfor %}
            </ul>
        </div>
        
    {% elif menu_style == 'vertical' %}
        <!-- Вертикальное меню -->
        <div class="vertical-menu">
            <ul class="menu-list vertical">
                {% for item in menu_tree %}
                    <li class="menu-item {{ item.custom_class }}{% if item.is_featured %} featured{% endif %}">
                        <a href="{{ item.url }}" 
                           class="menu-link"
                           {% if item.open_in_new_tab %}target="_blank" rel="noopener"{% endif %}>
                           
                            {% if show_icons and item.icon %}
                                <img src="{{ item.icon.url }}" alt="{{ item.title }}" class="menu-icon">
                            {% endif %}
                            
                            <span class="menu-text">{{ item.title }}</span>
                            
                            {% if item.children %}
                                <i class="fas fa-chevron-right expand-arrow"></i>
                            {% endif %}
                        </a>
                        
                        {% if item.children %}
                            <ul class="submenu vertical">
                                {% for child in item.children %}
                                    <li class="submenu-item">
                                        <a href="{{ child.url }}" 
                                           class="submenu-link"
                                           {% if child.open_in_new_tab %}target="_blank" rel="noopener"{% endif %}>
                                            {{ child.title }}
                                        </a>
                                    </li>
                                {% endfor %}
                            </ul>
                        {% endif %}
                    </li>
                {% endfor %}
            </ul>
        </div>
        
    {% elif menu_style == 'mega' %}
    <!-- Мегаменю в стиле Pangaia -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white">
        <div class="container-fluid">
        <!-- Основное меню для десктопа -->
        <ul class="menu-list mega d-none d-lg-flex navbar-nav me-auto mb-2 mb-lg-0">
                    {% for item in menu_tree %}
                            <li class="nav-item dropdown dropdown-mega">
                    <a href="{{ item.url or '#' }}"
                       class="nav-link dropdown-toggle {{ item.custom_class }}{% if item.is_featured %} featured{% endif %}"
                       {% if item.open_in_new_tab %}target="_blank" rel="noopener"{% endif %}
                       {% if item.children %}role="button" data-bs-toggle="dropdown" aria-expanded="false"{% endif %}>
                                    {% if show_icons and item.icon %}
                            <img src="{{ item.icon.url }}" alt="{{ item.title }}" class="menu-icon me-2">
                                    {% endif %}
                        <span class="menu-text">{{ item.title }}</span>
                        {% if item.children %}
                            <i class="fas fa-chevron-down dropdown-arrow ms-1"></i>
                        {% endif %}
                    </a>
                    {% if item.children %}
                        <div class="dropdown-menu" aria-labelledby="{{ item.title|lower|replace(' ', '') }}Menu">
                            <!-- Видео секция (абсолютное позиционирование) -->
                                            {% if enable_videos and item.video %}
                            <div class="mega-video">
                                <video autoplay muted loop playsinline>
                                                            <source src="{{ item.video.url }}" type="video/mp4">
                                                        </video>
                                                    </div>
                            {% endif %}

                            <!-- Контент секция -->
                            <div class="mega-content-container">
                                <div class="mega-content">
                                                    <div class="row">
                                    <!-- Featured секция -->
                                    {% if item.children and item.children[0] %}
                                    <div class="col-2">
                                        <h6>Featured</h6>
                                        <ul class="mb-4">
                                            {% for child in item.children[:4] %}
                                            <li>
                                                <a href="{{ child.url or '#' }}" {% if child.open_in_new_tab %}target="_blank" rel="noopener"{% endif %}>
                                                                        {{ child.title }}
                                                                                </a>
                                                                            </li>
                                                                        {% endfor %}
                                                                    </ul>
                                                            </div>
                                    {% endif %}

                                    <!-- Categories секция -->
                                    {% if item.children %}
                                    <div class="col-2">
                                        <h6>Categories</h6>
                                        <ul class="mb-4">
                                                {% for child in item.children %}
                                            <li>
                                                <a href="{{ child.url or '#' }}" {% if child.open_in_new_tab %}target="_blank" rel="noopener"{% endif %}>
                                                                {{ child.title }}
                                                                        </a>
                                                                    </li>
                                                                {% endfor %}
                                                            </ul>
                                                    </div>
                                            {% endif %}

                                    <!-- Shop by color секция -->
                                    <div class="col-2">
                                        <h6>Shop by color</h6>
                                        <ul class="mb-4">
                                            <li><a href="#">Black</a></li>
                                            <li><a href="#">White</a></li>
                                            <li><a href="#">Blue</a></li>
                                            <li><a href="#">Grey</a></li>
                                            <li><a href="#">Neutral</a></li>
                                            <li><a href="#">Pink</a></li>
                                            <li><a href="#">Purple</a></li>
                                            <li><a href="#">Red</a></li>
                                            <li><a href="#">Green</a></li>
                                        </ul>
                                        </div>

                                    <!-- Capsule секция -->
                                    <div class="col-2">
                                        <h6>Capsule</h6>
                                        <ul class="mb-4">
                                            <li><a href="#">365 Heavyweight</a></li>
                                            <li><a href="#">365 Midweight</a></li>
                                            <li><a href="#">DNA</a></li>
                                        </ul>
                                    </div>
                                </div>
                                </div>
                            </div>
                        </div>
                    {% endif %}
                            </li>
            {% endfor %}
        </ul>

                <!-- Затемнение фона -->
        <div class="mobile-menu-backdrop" id="mobileMenuBackdrop"></div>

        <!-- Мобильное меню в стиле Pangaia (выезжает сбоку) -->
        <div class="mobile-menu-drawer d-lg-none" id="mobileMenuDrawer">
            <div class="mobile-menu-container">
                <!-- Кнопка закрытия -->
                <button class="mobile-menu-close" id="mobileMenuClose">
                    <i class="fas fa-times"></i>
                </button>

                {% for item in menu_tree %}
                    {% if item.children %}
                        <!-- Главная категория -->
                        <div class="mobile-menu-section" data-category="{{ loop.index0 }}">
                            <!-- Заголовок категории -->
                            <div class="mobile-category-header">
                                <button class="mobile-category-toggle" data-category="{{ loop.index0 }}">
                                    {% if show_icons and item.icon %}
                                        <img src="{{ item.icon.url }}" alt="{{ item.title }}" class="menu-icon me-2" width="20" height="20">
                                    {% endif %}
                                    {{ item.title }}
                                </button>
                            </div>

                            <!-- Контент категории -->
                            <div class="mobile-category-content active" id="category-content-{{ loop.index0 }}">
                                <!-- Основное меню с табами -->
                                <div class="mobile-menu-main">
                                    <!-- Табированные колонки -->
                                    <div class="mobile-menu-tabs">
                                        <!-- Featured таб -->
                                        {% if item.children %}
                                        <button class="mobile-menu-tab active" data-tab="featured">
                                            Featured
                                        </button>
                                        {% endif %}

                                        <!-- Categories таб -->
                                        <button class="mobile-menu-tab" data-tab="categories">
                                            Categories
                                        </button>

                                        <!-- Shop by color таб -->
                                        <button class="mobile-menu-tab" data-tab="colors">
                                            Shop by color
                                        </button>

                                        <!-- Capsule таб -->
                                        <button class="mobile-menu-tab" data-tab="capsule">
                                            Capsule
                                        </button>
                                    </div>

                                    <!-- Контент табов -->
                                    <div class="mobile-menu-tab-content">
                                        <!-- Featured контент -->
                                        {% if item.children %}
                                        <div class="mobile-tab-pane active" data-tab="featured">
                                            <h6>Featured</h6>
                                            <ul class="mobile-menu-list">
                                                {% for child in item.children[:4] %}
                                                <li>
                                                    <a href="{{ child.url or '#' }}" {% if child.open_in_new_tab %}target="_blank" rel="noopener"{% endif %}>
                                                        {{ child.title }}
                                </a>
                            </li>
                                                {% endfor %}
                                            </ul>
                                        </div>
                        {% endif %}

                                        <!-- Categories контент -->
                                        <div class="mobile-tab-pane" data-tab="categories">
                                            <h6>Categories</h6>
                                            <ul class="mobile-menu-list">
                                                {% for child in item.children %}
                                                <li>
                                                    <a href="{{ child.url or '#' }}" {% if child.open_in_new_tab %}target="_blank" rel="noopener"{% endif %}>
                                                        {{ child.title }}
                                                    </a>
                                                </li>
                    {% endfor %}
                </ul>
            </div>
            
                                        <!-- Shop by color контент -->
                                        <div class="mobile-tab-pane" data-tab="colors">
                                            <h6>Shop by color</h6>
                                            <ul class="mobile-menu-list">
                                                <li><a href="#">Black</a></li>
                                                <li><a href="#">White</a></li>
                                                <li><a href="#">Blue</a></li>
                                                <li><a href="#">Grey</a></li>
                                                <li><a href="#">Neutral</a></li>
                                                <li><a href="#">Pink</a></li>
                                                <li><a href="#">Purple</a></li>
                                                <li><a href="#">Red</a></li>
                                                <li><a href="#">Green</a></li>
                                            </ul>
            </div>

                                        <!-- Capsule контент -->
                                        <div class="mobile-tab-pane" data-tab="capsule">
                                            <h6>Capsule</h6>
                                            <ul class="mobile-menu-list">
                                                <li><a href="#">365 Heavyweight</a></li>
                                                <li><a href="#">365 Midweight</a></li>
                                                <li><a href="#">DNA</a></li>
                                            </ul>
        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% endif %}
                {% endfor %}
            </div>
        </div>
        
    {% elif menu_style == 'mobile' %}
        <!-- Мобильное меню -->
        <div class="mobile-menu">
            <button class="mobile-menu-toggle" onclick="toggleMobileMenu()">
                <span class="hamburger"></span>
                <span class="hamburger"></span>
                <span class="hamburger"></span>
            </button>
            
            <div class="mobile-menu-overlay" id="mobileMenuOverlay" onclick="closeMobileMenu()"></div>
            
            <div class="mobile-menu-content" id="mobileMenuContent">
                <div class="mobile-menu-header">
                    <h4>{{ menu_title }}</h4>
                    <button class="mobile-menu-close" onclick="closeMobileMenu()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <ul class="mobile-menu-list">
                    {% for item in menu_tree %}
                        <li class="mobile-menu-item {{ item.custom_class }}{% if item.is_featured %} featured{% endif %}">
                            <div class="mobile-menu-link-wrapper">
                                <a href="{{ item.url }}" 
                                   class="mobile-menu-link"
                                   {% if item.open_in_new_tab %}target="_blank" rel="noopener"{% endif %}>
                                   
                                    {% if show_icons and item.icon %}
                                        <img src="{{ item.icon.url }}" alt="{{ item.title }}" class="mobile-menu-icon">
                                    {% endif %}
                                    
                                    <span class="mobile-menu-text">{{ item.title }}</span>
                                </a>
                                
                                {% if item.children %}
                                    <button class="mobile-submenu-toggle" onclick="toggleMobileSubmenu({{ loop.index0 }})">
                                        <i class="fas fa-chevron-down"></i>
                                    </button>
                                {% endif %}
                            </div>
                            
                            {% if item.children %}
                                <ul class="mobile-submenu" id="submenu-{{ loop.index0 }}">
                                    {% for child in item.children %}
                                        <li class="mobile-submenu-item">
                                            <a href="{{ child.url }}" 
                                               class="mobile-submenu-link"
                                               {% if child.open_in_new_tab %}target="_blank" rel="noopener"{% endif %}>
                                                {{ child.title }}
                                            </a>
                                        </li>
                                    {% endfor %}
                                </ul>
                            {% endif %}
                        </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    {% endif %}
</nav>

<style>
/* Базовые стили меню */
.menu-module {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
}

.menu-link, .submenu-link, .sub-submenu-link, .mobile-menu-link, .mobile-submenu-link {
    text-decoration: none;
    color: inherit;
    transition: all 0.3s ease;
}

.menu-icon, .submenu-icon, .mobile-menu-icon {
    width: 20px;
    height: 20px;
    margin-right: 8px;
    vertical-align: middle;
}

/* Горизонтальное меню */
.horizontal-menu .menu-list {
    display: flex;
    list-style: none;
    margin: 0;
    padding: 0;
    background: #fff;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.horizontal-menu .menu-item {
    position: relative;
}

.horizontal-menu .menu-link {
    display: flex;
    align-items: center;
    padding: 15px 20px;
    color: #333;
    border-bottom: 3px solid transparent;
}

.horizontal-menu .menu-link:hover {
    background: #f8f9fa;
    border-bottom-color: #007bff;
}

.horizontal-menu .submenu {
    position: absolute;
    top: 100%;
    left: 0;
    min-width: 200px;
    background: #fff;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    list-style: none;
    margin: 0;
    padding: 0;
    opacity: 0;
    visibility: hidden;
    transform: translateY(-10px);
    transition: all 0.3s ease;
}

.horizontal-menu .menu-item:hover .submenu {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
}

.horizontal-menu .submenu-link {
    display: block;
    padding: 12px 20px;
    color: #333;
}

.horizontal-menu .submenu-link:hover {
    background: #f8f9fa;
    color: #007bff;
}

/* Вертикальное меню */
.vertical-menu {
    width: 250px;
    background: #fff;
    border: 1px solid #e0e0e0;
    border-radius: 6px;
}

.vertical-menu .menu-list {
    list-style: none;
    margin: 0;
    padding: 0;
}

.vertical-menu .menu-link {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px 15px;
    color: #333;
    border-bottom: 1px solid #f0f0f0;
}

.vertical-menu .menu-link:hover {
    background: #f8f9fa;
    color: #007bff;
}

.vertical-menu .submenu {
    list-style: none;
    margin: 0;
    padding: 0;
    background: #f8f9fa;
    display: none;
}

.vertical-menu .menu-item:hover .submenu {
    display: block;
}

.vertical-menu .submenu-link {
    display: block;
    padding: 10px 30px;
    color: #666;
    font-size: 0.9em;
}

.vertical-menu .submenu-link:hover {
    background: #e9ecef;
    color: #007bff;
}

/* Мегаменю в стиле Pangaia - базовые стили, размеры устанавливает JS */
.dropdown-mega .dropdown-menu {
    /* Ширина, позиция и position устанавливаются JavaScript */
    margin: 0;
    padding: 0;
    border-radius: 0;
    border: none;
    box-shadow: 0 8px 24px rgba(0,0,0,0.12);
    z-index: 1050;
    overflow: hidden;
    min-height: 300px;
    /* Убираем трансформации которые могут мешать */
    transform: none !important;
    -webkit-transform: none !important;
}

/* Стили для мобильного выезжающего меню */
.mobile-menu-drawer {
    position: fixed;
    top: 0;
    right: -400px;
    width: 350px;
    height: 100vh;
    background: white;
    z-index: 1050;
    transition: right 0.3s ease;
    display: none;
    box-shadow: -2px 0 8px rgba(0, 0, 0, 0.15);
}

.mobile-menu-drawer.show {
    right: 0;
}

.mobile-menu-container {
    position: relative;
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

/* Кнопка закрытия */
.mobile-menu-close {
    position: absolute;
    top: 1rem;
    right: 1rem;
    z-index: 10;
    background: transparent;
    border: none;
    font-size: 1.5rem;
    color: #6c757d;
    cursor: pointer;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: all 0.2s ease;
}

.mobile-menu-close:hover {
    background: #f8f9fa;
    color: #495057;
}

/* Затемнение фона при открытом меню */
.mobile-menu-backdrop {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: rgba(0, 0, 0, 0.5);
    z-index: 1049;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
}

.mobile-menu-backdrop.show {
    opacity: 1;
    visibility: visible;
}

/* Стили для секций меню */
.mobile-menu-section {
    height: 100%;
    display: flex;
    flex-direction: column;
    position: relative;
}

.mobile-category-header {
    padding: 1rem;
    border-bottom: 1px solid #e9ecef;
    background: #f8f9fa;
}

.mobile-category-toggle {
    width: 100%;
    padding: 0.75rem 1rem;
    background: #007bff;
    color: white;
    border: none;
    border-radius: 8px;
    font-weight: 600;
    text-align: left;
    transition: all 0.2s ease;
}

.mobile-category-toggle:hover {
    background: #0056b3;
    transform: translateY(-1px);
}

.mobile-category-content {
    flex: 1;
    display: none;
    flex-direction: column;
    overflow: hidden;
}

.mobile-category-content.active {
    display: flex;
}

.mobile-menu-main {
    flex: 1;
    display: flex;
    flex-direction: column;
    position: relative;
}

.mobile-menu-tabs {
    display: flex;
    overflow-x: auto;
    padding: 0.75rem 1rem;
    gap: 0.5rem;
    border-bottom: 1px solid #e9ecef;
    background: white;
    scrollbar-width: none;
    -ms-overflow-style: none;
}

.mobile-menu-tabs::-webkit-scrollbar {
    display: none;
}

.mobile-menu-tab {
    padding: 0.5rem 1rem;
    background: transparent;
    border: none;
    border-radius: 20px;
    font-size: 0.875rem;
    font-weight: 500;
    color: #6c757d;
    white-space: nowrap;
    transition: all 0.2s ease;
    position: relative;
}

.mobile-menu-tab:hover {
    color: #495057;
    background: rgba(0,123,255,0.1);
}

.mobile-menu-tab.active {
    background: #007bff;
    color: white;
}

.mobile-menu-tab-content {
    flex: 1;
    position: relative;
    overflow: hidden;
}

.mobile-tab-pane {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    padding: 1rem;
    opacity: 0;
    visibility: hidden;
    transform: translateX(20px);
    transition: all 0.3s ease;
    overflow-y: auto;
}

.mobile-tab-pane.active {
    opacity: 1;
    visibility: visible;
    transform: translateX(0);
}

.mobile-menu-list {
    list-style: none;
    margin: 0;
    padding: 0;
}

.mobile-menu-list li {
    margin-bottom: 0.5rem;
}

.mobile-menu-list a {
    display: block;
    padding: 0.75rem 0;
    color: #495057;
    text-decoration: none;
    border-bottom: 1px solid #f0f0f0;
    transition: color 0.2s ease;
}

.mobile-menu-list a:hover {
    color: #007bff;
}

.mobile-menu-list h6 {
    font-weight: 700;
    margin-bottom: 1rem;
    color: #000;
    font-size: 0.875rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}



.dropdown-mega .dropdown-menu.show {
    display: block !important;
    opacity: 1 !important;
    visibility: visible !important;
}

/* Контейнер без Bootstrap отступов */
.mega-content-container {
        width: 100%;
    padding: 0;
    margin: 0;
    margin-right: 400px; /* Отступ для видео */
    }
    
    .mega-content {
    padding: 2rem;
    margin: 0;
    width: 100%;
}

/* Минимальные переопределения Bootstrap для корректной работы */
.dropdown-mega .container,
.dropdown-mega .container-fluid {
    /* Убираем отступы которые могут мешать позиционированию */
    padding-left: 0 !important;
    padding-right: 0 !important;
}/* Переопределяем отступы navbar только для мегаменю */
.dropdown-mega .navbar .container-fluid {
    padding-left: 0 !important;
}

.mega-content h6 {
    font-weight: 700;
    margin-bottom: 0.75rem;
    color: #000;
    font-size: 0.875rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.mega-content li {
    list-style: none;
    margin-bottom: 0.5rem;
}

.mega-content a {
    color: #000;
    text-decoration: none;
    font-size: 0.9rem;
    transition: color 0.2s ease;
}

.mega-content a:hover {
    text-decoration: underline;
    color: #007bff;
}

.mega-content ul {
    margin: 0;
    padding: 0;
}

/* Видео в мегаменю */
.mega-video {
    position: absolute;
    top: 0;
    right: 0;
    width: 400px;
    height: 100%;
    overflow: hidden;
}

.mega-video video {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

/* Адаптивность для мегаменю */
@media (max-width: 992px) {
    .mega-content-container {
        margin-right: 0; /* Убираем отступ для видео на мобильных */
    }

    .mega-content {
        max-width: none;
    }

    .mega-video {
        display: none; /* Скрываем видео на мобильных */
    }

    /* Также убираем все отступы на мобильных */
    .dropdown-mega .container,
    .dropdown-mega .container-fluid,
    .dropdown-mega .row {
        padding-left: 0 !important;
        padding-right: 0 !important;
        margin-left: 0 !important;
        margin-right: 0 !important;
    }
}

@media (max-width: 768px) {
    .mega-content {
        padding: 1rem;
    }

    .mega-content .col-2 {
        margin-bottom: 1rem;
    }

    .dropdown-mega .dropdown-menu {
        /* Размеры устанавливаются JavaScript */
        left: 0;
        margin-left: 0;
    }
}

/* Выделенные пункты */
.featured {
    position: relative;
}

.featured::after {
    content: '';
    position: absolute;
    top: 0;
    right: 0;
    width: 6px;
    height: 6px;
    background: #ff6b6b;
    border-radius: 50%;
}

/* Адаптивность */
@media (max-width: 1024px) {
    .mega-container {
        flex-direction: column;
        padding: 30px 20px;
    }
    
    .mega-video {
        width: 100%;
        height: 250px;
        min-height: 250px;
        order: -1;
    }
}

@media (max-width: 992px) {
    /* Скрываем десктопное меню на планшетах и мобильных */
    .mega-menu .menu-list.mega {
        display: none !important;
    }

    /* Показываем мобильное меню выезжающее сбоку */
    .mobile-menu-drawer {
        display: block !important;
    }
}

@media (max-width: 768px) {
    .horizontal-menu { display: none; }
    .mega-categories {
        grid-template-columns: repeat(2, minmax(160px, 1fr)); gap: 12px;
    }

    /* Адаптация мобильного меню для маленьких экранов */
    .mobile-menu-drawer {
        width: 300px !important;
        right: -300px !important;
    }

    .mobile-menu-tabs {
        padding: 0.5rem !important;
        gap: 0.25rem !important;
    }

    .mobile-menu-tab {
        padding: 0.4rem 0.8rem !important;
        font-size: 0.8rem !important;
    }
}

@media (max-width: 480px) {
    /* Для очень маленьких экранов */
    .mobile-menu-drawer {
        width: 280px !important;
        right: -280px !important;
    }

    .mobile-menu-tabs {
        padding: 0.4rem !important;
        gap: 0.2rem !important;
    }

    .mobile-menu-tab {
        padding: 0.3rem 0.6rem !important;
        font-size: 0.75rem !important;
    }
}

@media (min-width: 769px) {
    .mobile-menu {
        display: none;
    }
}
</style>

<script>
// JavaScript для мегаменю и мобильного меню
document.addEventListener('DOMContentLoaded', function() {
    // Функция для установки ширины и позиции мега-меню
    function setMegaMenuDimensions() {
        // Используем viewport размеры вместо body для точного позиционирования
        const viewportWidth = window.innerWidth;

        // Находим navbar с учетом его позиции на странице
        const navbar = document.querySelector('.navbar');
        let navbarTop = 0;
        if (navbar) {
            const navbarRect = navbar.getBoundingClientRect();
            navbarTop = navbarRect.bottom; // Используем нижнюю границу navbar
        }

        // Применяем к всем мега-меню
        document.querySelectorAll('.dropdown-mega .dropdown-menu').forEach(function(menu) {
            menu.style.width = viewportWidth + 'px';
            menu.style.position = 'fixed';
            menu.style.left = '0px';
            menu.style.top = navbarTop + 'px';
            menu.style.right = 'auto';
            menu.style.marginLeft = '0px';
            // Убеждаемся, что меню не блокирует клики
            menu.style.pointerEvents = 'auto';
            menu.style.zIndex = '1050';
        });
    }

    // Вызываем при загрузке страницы
    setMegaMenuDimensions();

    // Инициализация мобильного меню
    function initializeMobileMenu() {
        // Обработка клика на navbar-toggler для показа мобильного меню
        const navbarToggler = document.querySelector('.navbar-toggler');
        const mobileMenuDrawer = document.getElementById('mobileMenuDrawer');
        const mobileMenuClose = document.getElementById('mobileMenuClose');

        const mobileMenuBackdrop = document.getElementById('mobileMenuBackdrop');

        if (navbarToggler && mobileMenuDrawer) {
            navbarToggler.addEventListener('click', function(e) {
                e.preventDefault();
                mobileMenuDrawer.classList.add('show');
                if (mobileMenuBackdrop) {
                    mobileMenuBackdrop.classList.add('show');
                }
                document.body.style.overflow = 'hidden';
            });
        }

        // Обработка закрытия меню
        if (mobileMenuClose) {
            mobileMenuClose.addEventListener('click', function() {
                mobileMenuDrawer.classList.remove('show');
                if (mobileMenuBackdrop) {
                    mobileMenuBackdrop.classList.remove('show');
                }
                document.body.style.overflow = '';
            });
        }

        // Закрытие меню по клику на backdrop
        if (mobileMenuBackdrop) {
            mobileMenuBackdrop.addEventListener('click', function() {
                mobileMenuDrawer.classList.remove('show');
                mobileMenuBackdrop.classList.remove('show');
                document.body.style.overflow = '';
            });
        }

        // Обработка табов
        document.querySelectorAll('.mobile-menu-tab').forEach(function(tab) {
            tab.addEventListener('click', function() {
                const tabName = this.dataset.tab;
                const tabContent = this.closest('.mobile-menu-main');

                // Убираем активные классы у всех табов
                tabContent.querySelectorAll('.mobile-menu-tab').forEach(function(t) {
                    t.classList.remove('active');
                });

                // Добавляем активный класс текущему табу
                this.classList.add('active');

                // Скрываем все pane
                tabContent.querySelectorAll('.mobile-tab-pane').forEach(function(pane) {
                    pane.classList.remove('active');
                });

                // Показываем соответствующий pane
                const targetPane = tabContent.querySelector('[data-tab="' + tabName + '"]');
                if (targetPane) {
                    targetPane.classList.add('active');
                }
            });
        });

        // Обработка кликов по элементам меню
        document.querySelectorAll('.mobile-menu-list a').forEach(function(link) {
            link.addEventListener('click', function() {
                // Закрываем мобильное меню после клика на ссылку
                if (mobileMenuDrawer) {
                    mobileMenuDrawer.classList.remove('show');
                    if (mobileMenuBackdrop) {
                        mobileMenuBackdrop.classList.remove('show');
                    }
                    document.body.style.overflow = '';
                }
            });
        });
    }

    // Вызываем инициализацию мобильного меню
    initializeMobileMenu();

    // Обработка мегаменю
    const megaDropdowns = document.querySelectorAll('.dropdown-mega');
    let hideTimeout;

    megaDropdowns.forEach(function(dropdown) {
        const toggle = dropdown.querySelector('.dropdown-toggle');
        const menu = dropdown.querySelector('.dropdown-menu');

        if (toggle && menu) {
            // Обработка наведения мыши для десктопа
            dropdown.addEventListener('mouseenter', function() {
                if (window.innerWidth >= 992) { // Только на десктопе
                    clearTimeout(hideTimeout);
                    // Устанавливаем размеры перед показом
                    setMegaMenuDimensions();
                    menu.classList.add('show');
                }
            });

            // Обработка ухода мыши с главного пункта
            dropdown.addEventListener('mouseleave', function(e) {
                if (window.innerWidth >= 992) { // Только на десктопе
                    // Увеличиваем задержку скрытия до 700мс для более плавной работы
                    hideTimeout = setTimeout(() => {
                        // Проверяем, находится ли курсор в разумной близости от меню
                        const rect = menu.getBoundingClientRect();
                        const mouseX = e.clientX;
                        const mouseY = e.clientY;

                        // Создаем зону комфорта 50px вокруг меню
                        const comfortZone = 50;
                        const extendedRect = {
                            left: rect.left - comfortZone,
                            right: rect.right + comfortZone,
                            top: rect.top - comfortZone,
                            bottom: rect.bottom + comfortZone
                        };

                        // Скрываем только если курсор далеко от меню
                        if (mouseX < extendedRect.left || mouseX > extendedRect.right ||
                            mouseY < extendedRect.top || mouseY > extendedRect.bottom) {
                            menu.classList.remove('show');
                        }
                    }, 700); // Увеличили задержку для плавности
                }
            });

            // Обработка наведения на само меню
            menu.addEventListener('mouseenter', function() {
                if (window.innerWidth >= 992) {
                    clearTimeout(hideTimeout);
                }
            });

            // Обработка ухода мыши с меню
            menu.addEventListener('mouseleave', function(e) {
                if (window.innerWidth >= 992) {
                    // Добавляем дополнительную задержку для плавности
                    hideTimeout = setTimeout(() => {
                        // Сначала проверяем, не перешли ли мы на другой элемент мега-меню
                        const relatedTarget = e.relatedTarget;
                        const isMovingToAnotherMenu = relatedTarget &&
                            (relatedTarget.closest('.dropdown-mega') === dropdown ||
                             relatedTarget.closest('.dropdown-menu') === menu);

                        if (!isMovingToAnotherMenu) {
                            // Если не перешли на другой элемент, проверяем расстояние курсора
                            const rect = menu.getBoundingClientRect();
                            const mouseX = e.clientX;
                            const mouseY = e.clientY;

                            // Создаем зону комфорта 30px вокруг меню
                            const comfortZone = 30;
                            const extendedRect = {
                                left: rect.left - comfortZone,
                                right: rect.right + comfortZone,
                                top: rect.top - comfortZone,
                                bottom: rect.bottom + comfortZone
                            };

                            // Скрываем только если курсор далеко от меню
                            if (mouseX < extendedRect.left || mouseX > extendedRect.right ||
                                mouseY < extendedRect.top || mouseY > extendedRect.bottom) {
                                menu.classList.remove('show');
                            }
                        }
                    }, 800); // Увеличили задержку для более плавной работы
                }
            });

            // Обработка клика для мобильных устройств
            toggle.addEventListener('click', function(e) {
                if (window.innerWidth < 992) { // Только на мобильных
                    e.preventDefault();
                    // Устанавливаем размеры перед показом
                    setMegaMenuDimensions();
                    menu.classList.toggle('show');
                }
            });
        }
    });

    // Закрытие меню при клике вне их
    document.addEventListener('click', function(event) {
        // Проверяем, что клик был не на элементе меню
        if (!event.target.closest('.dropdown-mega') && !event.target.closest('.dropdown-menu') &&
            !event.target.closest('.mobile-menu-dropdown')) {
            clearTimeout(hideTimeout);
            // Закрываем все открытые меню
            document.querySelectorAll('.dropdown-mega .dropdown-menu').forEach(function(menu) {
                menu.classList.remove('show');
            });
            document.querySelectorAll('.mobile-menu-dropdown').forEach(function(menu) {
                menu.classList.remove('show');
            });
        }
    });

    // Обработка изменения размера окна
    window.addEventListener('resize', function() {
        clearTimeout(hideTimeout);
        // Обновляем размеры при изменении окна
        setMegaMenuDimensions();

        // Закрываем все открытые меню при изменении размера
        document.querySelectorAll('.dropdown-mega .dropdown-menu').forEach(function(menu) {
            menu.classList.remove('show');
        });
        // Закрываем мобильные dropdown меню
        document.querySelectorAll('.mobile-menu-dropdown').forEach(function(menu) {
            menu.classList.remove('show');
        });
    });



    // Обработка скролла страницы для sticky navbar
    window.addEventListener('scroll', function() {
        // Обновляем позицию меню при скролле, если оно открыто
        const openMenus = document.querySelectorAll('.dropdown-mega .dropdown-menu.show');
        if (openMenus.length > 0) {
            setMegaMenuDimensions();
        }
    });
});

// JavaScript для мобильного меню
function toggleMobileMenu() {
    const overlay = document.getElementById('mobileMenuOverlay');
    const content = document.getElementById('mobileMenuContent');
    
    overlay.classList.toggle('show');
    content.classList.toggle('show');
}

function closeMobileMenu() {
    const overlay = document.getElementById('mobileMenuOverlay');
    const content = document.getElementById('mobileMenuContent');
    
    overlay.classList.remove('show');
    content.classList.remove('show');
}

function toggleMobileSubmenu(index) {
    const submenu = document.getElementById(`submenu-${index}`);
    const toggle = submenu.previousElementSibling.querySelector('.mobile-submenu-toggle i');
    
    submenu.classList.toggle('show');
    toggle.classList.toggle('fa-chevron-down');
    toggle.classList.toggle('fa-chevron-up');
}

// Закрытие меню при клике вне его
document.addEventListener('click', function(event) {
    const menuContent = document.getElementById('mobileMenuContent');
    const menuToggle = document.querySelector('.mobile-menu-toggle');
    
    if (menuContent && menuToggle && 
        !menuContent.contains(event.target) && 
        !menuToggle.contains(event.target)) {
        closeMobileMenu();
    }
});
</script>